// You can edit this code!
// Click here and start typing.
package main

import (
	"fmt"
	"math"
	"slices"
	"strings"
)

func main() {
	// Expand the galaxy
	// For each row and column
	// For range 0 to maxX, find the non-x
	// Repeat for y.
	fmt.Println(solve(example, 1))    // 374
	fmt.Println(solve(input, 1))      // 9686930
	fmt.Println(solve(example, 9))    // 1030
	fmt.Println(solve(example, 99))   // 8410
	fmt.Println(solve(input, 999999)) // 630729056210
}

func solve(input string, dist int) int {
	grid := parse(input)
	rows, cols := noGalaxies(grid)
	grid = bigBang(grid, rows, cols, dist)
	pairs := pair(grid)
	var result int
	for p := range pairs {
		a := p.x
		b := p.y
		// Shortest path is manhattan distance ...
		dist := math.Abs(real(a)-real(b)) + math.Abs(imag(a)-imag(b))
		result += int(dist)
	}
	return result
}

type Pair struct {
	x, y complex128
}

func pair(grid map[complex128]rune) map[Pair]bool {
	res := make(map[Pair]bool)
	var galaxies []complex128
	for k := range grid {
		galaxies = append(galaxies, k)
	}
	for i, g := range galaxies {
		for _, h := range galaxies[i+1:] {
			res[Pair{x: g, y: h}] = true
		}
	}
	return res
}

// To expand, just increment by 1 whenever the x or y value is greater than the existing value
func bigBang(grid map[complex128]rune, rows, cols []int, dist int) map[complex128]rune {
	result := make(map[complex128]rune)
	for k, v := range grid {
		x := int(real(k))
		y := int(imag(k))

		var dx, dy int
		for _, nx := range cols {
			if x > nx {
				dx++
			}
		}
		for _, ny := range rows {
			if y > ny {
				dy++
			}
		}
		x += dx * dist
		y += dy * dist
		result[complex(float64(x), float64(y))] = v
	}
	return result
}

func noGalaxies(grid map[complex128]rune) (rows, cols []int) {
	var xs, ys []float64
	var maxX, maxY float64
	for k := range grid {
		x := real(k)
		y := imag(k)
		xs = append(xs, x)
		ys = append(ys, y)
		maxX = max(maxX, x)
		maxY = max(maxY, y)
	}
	xs = slices.Compact(xs)
	ys = slices.Compact(ys)
	for i := 0; i <= int(maxX); i++ {
		if !slices.Contains(xs, float64(i)) {
			cols = append(cols, i)
		}
	}
	for i := 0; i <= int(maxY); i++ {
		if !slices.Contains(ys, float64(i)) {
			rows = append(rows, i)
		}
	}
	slices.Sort(rows)
	slices.Sort(cols)
	return
}

func parse(input string) map[complex128]rune {
	m := make(map[complex128]rune)
	for y, line := range strings.Split(input, "\n") {
		for x, c := range line {
			if c != '#' {
				continue
			}
			m[complex(float64(x), float64(y))] = c
		}
	}

	return m
}

var example = `...#......
.......#..
#.........
..........
......#...
.#........
.........#
..........
.......#..
#...#.....`

var input = `.#...........#.........................................................................#...............#...........#........................
.......................#....................................................................................................................
...............................#...........#.................#.............................#.............................................#..
......#............................................#........................................................................................
......................................................................#.....#.....................#.........................................
.................#.......#.......................................#................#.....#.....................#.............................
.........................................#.................#................................................................................
................................#.............................................................#..........#..................................
#.......................................................................#..............................................#.................#..
..........#....................................#......................................#............................................#........
................#....................................#........#.............................................................................
......#........................................................................#............................................................
......................#..............#..............................................................#..........#.....#......................
..................................................#.......................#..................................................#..........#...
............................#...............................................................................................................
........#...................................................................................................................................
..................#.......................#................................................................#................................
.............................................................#........#.....................................................................
..............................#.......#......................................#.............#........................#.......................
.#............................................................................................................#...........................#.
...................................................................................................#....................#...................
....................#......................#.............#.....#..................................................................#.........
.................................................................................................................#..........................
............................................................................................................................................
....................................................................#.....................#.................................................
.................................#..............................................#..............#............#.............#.................
...........................#............................................#...........................................#.......................
......................#.........................#...........................................................................................
.......................................#....................................#...................................#...........................
.....#..........#.........................................#...............................................................................#.
#..........#......................#...................................................#.......#.....#.......................................
.........................#..................................................................................................................
....................#..............................#.............#.........................................#.......#........#...............
...........................................#........................................................................................#.......
...........................................................#....................#...........................................................
..........#....................................................................................................#............................
...............#................................#..........................#..............................................................#.
..#.................................#.................................................................#.......................#.............
.....................#......#...............#........................#................................................#.....................
..............................................................................................#....................................#........
................................#.......#...................................................................................................
..........#................................................#...................#.....#..............#..........#..........#.................
.........................#..................................................................................................................
..................#...............................#...........................................................................#.............
.........................................................................#............................................#.....................
........#.....#..............................................................................#.........#..................................#.
.#...............................#......#............#.............................................................................#........
....................................................................................#.............#...............#........#................
...........................#................................................................................................................
......................#..................................#..............#................................#.............#................#...
...............................................................#..............#.............................................................
..................................#........................................................#........#.......................................
......#.................................#.......#....................#...............................................................#......
.................#............#..............................................................................#.............................#
............................................................................................................................................
..#.....................#.............................................................................#.....................................
.......................................................................................#..............................#.....................
...............................................................................#.............#..............................................
....................#.....................#...............................................................#.................................
..........#........................#............#...................#.............................................#...............#.........
............................#.............................#..........................#......................................................
...........................................................................................#................................................
.................................................................#.................................#.........................#........#.....
.................#........................................................#..................................#..............................
......................................#......................#..............................................................................
.............#...........#...............................................................................#..........#.......................
.................................#...........#...........................................................................#..............#...
.......#............................................#.....#....................#..............#.....#.......................................
...................#...........................................#................................................#...........................
........................................................................................#...................................................
...#....................#.....#............#.........................................................................................#......
...............#.............................................................#..................#........#................#.................
.........#.....................................#............................................................................................
................................................................................................................................#...........
.....................#.............#.........................................................................#..............................
.....#...............................................................................................................#..............#......#
...........#.......................................#.....#.................#.................#..............................................
............................................................................................................................................
.#.......................................#..........................................#................#......................................
......................#.............#.................#.......................#...........#.............................#...................
...............#.............#................................#......#.......................................................#..............
............................................................................................................................................
...#............................................................................................#....................#......................
..........#.....................#.............................................................................#.............................
...........................#...............................................................................................#...............#
.....................#......................................#.......#......#........#..................#...........................#........
.....#...............................#............#.........................................................................................
............................................................................................................................................
.........................................................#........................................................#.........................
#..............................#..........#..............................................................................#................#.
....................#..............................................#.......................#.........#......................................
............................................................................................................................................
...........#.......................................#.............................................................................#..........
...#......................#...............................................#......................#..........................................
..................#.........................................................................................................................
...........................................................#........#...........#.....#......#........................#.................#...
........#...................................................................................................................................
....................................................................................................#......#................................
................................#...........#....................#.....#...................................................#........#.......
........................#............#......................................#.............#.................................................
...................#............................................................................................#...........................
#................................................................................................................................#..........
..............#.............................................#...............................................................................
..............................#...............................................#.................#......................................#....
....#....................#......................................#...................#...............................#.......#...............
........................................#..........#........................................#................#..............................
............................................................................................................................................
............................................................................................................................................
........................................................................................................................................#...
...........................................................#..................#.................#.................#.........................
.......#........................................................#................................................................#..........
..........................#......#......#..................................................................................#................
...............................................#.....#.................#....................................................................
......................................................................................................#.....................................
................#....................#.....................................................................#........#.......................
..............................................................................................................................#.............
...........................................#.............................................................................................#..
....#........................#..............................#.............#................#................................................
......................#..........................................................................................#......#...................
....................................................#................................#.........#............................................
..........................#.......................................#.........................................................................
.................#........................#.....#........................................................#..................................
.#.........................................................#............#....................................................#..............
..........#..................#.....#..................................................................................................#.....
.................................................................................#..........................................................
.....................................................#....................................#.........#...........#.....#.....................
.............................................#.....................#.......................................#.......................#........
................................#...........................................................................................................
......#........................................................#..............................#.............................................
............#......................................#.....#............................#........................................#............
............................................................................#...............................................................
.......................................#...............................#...................#..............................#...........#.....
.......................#..............................#..........................#..............................#...........................
.................................................................#...................................#......................................
......................................................................................................................#...................#.
.................#..........................................................................................................................
.........#......................#.....#...........#.......................................................#.................................
...........................................#.................#................#.....................................................#.......
..#...............................................................#.........................................................................
.....................#......#......#.............................................................#............#...........#.................`
